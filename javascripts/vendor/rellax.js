// Copyright (c) 2016 Moe Amaya (@moeamaya)
!function(e,t){"function"==typeof define&&define.amd?define([],t):"object"==typeof module&&module.exports?module.exports=t():e.Rellax=t()}(this,function(){var e=function(t,n){"use strict";var o=Object.create(e.prototype),r=0,i=0,s=[],a=!1,d=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame||function(e){setTimeout(e,1e3/60)},l=window.transformProp||function(){var e=document.createElement("div");if(null==e.style.transform){var t=["Webkit","Moz","ms"];for(var n in t)if(e.style[t[n]+"Transform"]!==undefined)return t[n]+"Transform"}return"transform"}(),u=function(e,t,n){return e<=t?t:e>=n?n:e};o.options={speed:-2,center:!1,round:!0},n&&Object.keys(n).forEach(function(e){o.options[e]=n[e]}),o.options.speed=u(o.options.speed,-10,10),t||(t=".rellax");var c=document.querySelectorAll(t);if(!(c.length>0))throw new Error("The elements you're trying to select don't exist.");o.elems=c;var f=function(){i=window.innerHeight,p();for(var e=0;e<o.elems.length;e++){var t=m(o.elems[e]);s.push(t)}window.addEventListener("resize",function(){g()}),v(),g()},m=function(e){var t=e.dataset.rellaxPercentage,n=e.dataset.rellaxSpeed,r=t||o.options.center?window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop:0,s=r+e.getBoundingClientRect().top,a=e.clientHeight||e.offsetHeight||e.scrollHeight,d=t?t:(r-s+i)/(a+i);o.options.center&&(d=.5);var l=n?u(n,-10,10):o.options.speed;(t||o.options.center)&&(l=u(n||o.options.speed,-5,5));var c=w(d,l),f=e.style.cssText,m="";if(f.indexOf("transform")>=0){var p=f.indexOf("transform"),v=f.slice(p),g=v.indexOf(";");m=g?" "+v.slice(11,g).replace(/\s/g,""):" "+v.slice(11).replace(/\s/g,"")}return{base:c,top:s,height:a,speed:l,style:f,transform:m}},p=function(){var e=r;return r=window.pageYOffset!==undefined?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop,e!=r},w=function(e,t){var n=t*(100*(1-e));return o.options.round?Math.round(n):n},v=function(){p()&&a===!1&&g(),d(v)},g=function(){for(var e=0;e<o.elems.length;e++){var t=(r-s[e].top+i)/(s[e].height+i),n=w(t,s[e].speed)-s[e].base,a="translate3d(0,"+n+"px,0) "+s[e].transform;o.elems[e].style[l]=a}};return o.destroy=function(){for(var e=0;e<o.elems.length;e++)o.elems[e].style.cssText=s[e].style;a=!0},f(),o};return e});