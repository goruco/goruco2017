"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(e,t){"function"==typeof define&&define.amd?define([],t):"object"===("undefined"==typeof exports?"undefined":_typeof(exports))?module.exports=t():e.LazyLoad=t()}(window,function(){var e="onscroll"in window&&!/glebot/.test(navigator.userAgent),t=function(e){return e.getBoundingClientRect().top+window.pageYOffset-e.ownerDocument.documentElement.clientTop},n=function(e,n,o){return(n===window?window.innerHeight+window.pageYOffset:t(n)+n.offsetHeight)<=t(e)-o},o=function(e){return e.getBoundingClientRect().left+window.pageXOffset-e.ownerDocument.documentElement.clientLeft},i=function(e,t,n){var i=window.innerWidth;return(t===window?i+window.pageXOffset:o(t)+i)<=o(e)-n},s=function(e,n,o){return(n===window?window.pageYOffset:t(n))>=t(e)+o+e.offsetHeight},r=function(e,t,n){return(t===window?window.pageXOffset:o(t))>=o(e)+n+e.offsetWidth},l=function(e,t,o){return!(n(e,t,o)||s(e,t,o)||i(e,t,o)||r(e,t,o))},a=function(e,t){e&&e(t)},c={elements_selector:"img",container:window,threshold:300,throttle:150,data_src:"original",data_srcset:"original-set",class_loading:"loading",class_loaded:"loaded",class_error:"error",skip_invisible:!0,callback_load:null,callback_error:null,callback_set:null,callback_processed:null};return function(){function t(e){_classCallCheck(this,t),this._settings=Object.assign({},c,e),this._queryOriginNode=this._settings.container===window?document:this._settings.container,this._previousLoopTime=0,this._loopTimeout=null,this._boundHandleScroll=this.handleScroll.bind(this),window.addEventListener("resize",this._boundHandleScroll),this.update()}return _createClass(t,[{key:"_setSourcesForPicture",value:function(e,t){var n=e.parentElement;if("PICTURE"===n.tagName)for(var o=0;o<n.children.length;o++){var i=n.children[o];if("SOURCE"===i.tagName){var s=i.getAttribute("data-"+t);s&&i.setAttribute("srcset",s)}}}},{key:"_setSources",value:function(e,t,n){var o=e.tagName,i=e.getAttribute("data-"+n);if("IMG"===o){this._setSourcesForPicture(e,t);var s=e.getAttribute("data-"+t);return s&&e.setAttribute("srcset",s),void(i&&e.setAttribute("src",i))}if("IFRAME"===o)return void(i&&e.setAttribute("src",i));i&&(e.style.backgroundImage="url("+i+")")}},{key:"_showOnAppear",value:function(e){var t=this._settings,n=function n(){t&&(e.removeEventListener("load",o),e.removeEventListener("error",n),e.classList.remove(t.class_loading),e.classList.add(t.class_error),a(t.callback_error,e))},o=function o(){t&&(e.classList.remove(t.class_loading),e.classList.add(t.class_loaded),e.removeEventListener("load",o),e.removeEventListener("error",n),a(t.callback_load,e))};"IMG"!==e.tagName&&"IFRAME"!==e.tagName||(e.addEventListener("load",o),e.addEventListener("error",n),e.classList.add(t.class_loading)),this._setSources(e,t.data_srcset,t.data_src),a(t.callback_set,e)}},{key:"_loopThroughElements",value:function(){var t=this._settings,n=this._elements,o=n?n.length:0,i=void 0,s=[];for(i=0;i<o;i++){var r=n[i];t.skip_invisible&&null===r.offsetParent||e&&l(r,t.container,t.threshold)&&(this._showOnAppear(r),s.push(i),r.wasProcessed=!0)}for(;s.length>0;)n.splice(s.pop(),1),a(t.callback_processed,n.length);0===o&&this._stopScrollHandler()}},{key:"_purgeElements",value:function(){var e=this._elements,t=e.length,n=void 0,o=[];for(n=0;n<t;n++){e[n].wasProcessed&&o.push(n)}for(;o.length>0;)e.splice(o.pop(),1)}},{key:"_startScrollHandler",value:function(){this._isHandlingScroll||(this._isHandlingScroll=!0,this._settings.container.addEventListener("scroll",this._boundHandleScroll))}},{key:"_stopScrollHandler",value:function(){this._isHandlingScroll&&(this._isHandlingScroll=!1,this._settings.container.removeEventListener("scroll",this._boundHandleScroll))}},{key:"handleScroll",value:function(){var e=this._settings.throttle;if(0!==e){var t=function(){(new Date).getTime()},n=t(),o=e-(n-this._previousLoopTime);o<=0||o>e?(this._loopTimeout&&(clearTimeout(this._loopTimeout),this._loopTimeout=null),this._previousLoopTime=n,this._loopThroughElements()):this._loopTimeout||(this._loopTimeout=setTimeout(function(){this._previousLoopTime=t(),this._loopTimeout=null,this._loopThroughElements()}.bind(this),o))}else this._loopThroughElements()}},{key:"update",value:function(){this._elements=Array.prototype.slice.call(this._queryOriginNode.querySelectorAll(this._settings.elements_selector)),this._purgeElements(),this._loopThroughElements(),this._startScrollHandler()}},{key:"destroy",value:function(){window.removeEventListener("resize",this._boundHandleScroll),this._loopTimeout&&(clearTimeout(this._loopTimeout),this._loopTimeout=null),this._stopScrollHandler(),this._elements=null,this._queryOriginNode=null,this._settings=null}}]),t}()});